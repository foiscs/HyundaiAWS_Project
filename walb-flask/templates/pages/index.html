{% extends "base.html" %} {% block title %}WALB ëŒ€ì‹œë³´ë“œ{% endblock %} {% block content %}
<!-- Hero Section -->
<div class="bg-gradient-to-r from-blue-600 to-purple-600 rounded-2xl p-8 text-white mb-8 relative overflow-hidden">
    <div class="relative z-10">
        <div class="flex items-center mb-4">
            <span class="text-4xl mr-4 animate-bounce">ğŸ›¡ï¸</span>
            <div>
                <h1 class="text-3xl font-bold mb-2">WALB í´ë¼ìš°ë“œ ë³´ì•ˆ ê´€ë¦¬ ì†”ë£¨ì…˜</h1>
                <p class="text-blue-100">ë©€í‹° í´ë¼ìš°ë“œ í™˜ê²½ì˜ ë³´ì•ˆì„ í•˜ë‚˜ë¡œ í†µí•© ê´€ë¦¬í•˜ì„¸ìš”</p>
            </div>
        </div>
    </div>

    <!-- Background Pattern -->
    <div class="absolute inset-0 opacity-10">
        <div class="absolute top-10 right-10 w-20 h-20 bg-white rounded-full animate-pulse"></div>
        <div class="absolute bottom-10 right-20 w-16 h-16 bg-white rounded-full animate-pulse delay-1000"></div>
        <div class="absolute top-20 left-20 w-12 h-12 bg-white rounded-full animate-pulse delay-2000"></div>
    </div>
</div>

<!-- Stats Grid -->
<div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
    <div class="bg-white p-6 rounded-xl shadow-sm border">
        <div class="flex items-center">
            <div class="p-3 bg-blue-100 rounded-lg">
                <span class="text-2xl">â˜ï¸</span>
            </div>
            <div class="ml-4">
                <p class="text-sm text-gray-600">ì´ ê³„ì •</p>
                <p class="text-2xl font-bold text-gray-900">{{ stats.total_accounts }}</p>
            </div>
        </div>
    </div>

    <div class="bg-white p-6 rounded-xl shadow-sm border">
        <div class="flex items-center">
            <div class="p-3 bg-green-100 rounded-lg">
                <span class="text-2xl">âœ…</span>
            </div>
            <div class="ml-4">
                <p class="text-sm text-gray-600">í™œì„± ê³„ì •</p>
                <p class="text-2xl font-bold text-gray-900">{{ stats.active_accounts }}</p>
            </div>
        </div>
    </div>

    <div class="bg-white p-6 rounded-xl shadow-sm border">
        <div class="flex items-center">
            <div class="p-3 bg-purple-100 rounded-lg">
                <span class="text-2xl">ğŸ›¡ï¸</span>
            </div>
            <div class="ml-4">
                <p class="text-sm text-gray-600">Role ê¸°ë°˜</p>
                <p class="text-2xl font-bold text-gray-900">{{ stats.role_based }}</p>
            </div>
        </div>
    </div>

    <div class="bg-white p-6 rounded-xl shadow-sm border">
        <div class="flex items-center">
            <div class="p-3 bg-orange-100 rounded-lg">
                <span class="text-2xl">ğŸ”‘</span>
            </div>
            <div class="ml-4">
                <p class="text-sm text-gray-600">Key ê¸°ë°˜</p>
                <p class="text-2xl font-bold text-gray-900">{{ stats.key_based }}</p>
            </div>
        </div>
    </div>
</div>

<!-- Action Buttons -->
<div class="flex gap-4 mb-8">
    <a href="{{ url_for('connection.index') }}" class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium"> â• ìƒˆ AWS ê³„ì • ì¶”ê°€ </a>
    <button onclick="location.reload()" class="px-6 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors font-medium">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
</div>

<!-- Accounts Section -->
<div class="bg-white rounded-xl shadow-sm border p-6 mb-8">
    <div class="flex items-center justify-between mb-6">
        <h2 class="text-xl font-bold text-gray-900">â˜ï¸ ì—°ê²°ëœ AWS ê³„ì •</h2>
        <span class="text-sm text-gray-500">ì´ {{ accounts|length }}ê°œ</span>
    </div>

    {% if accounts %}
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        {% for account in accounts %}
        <div class="border rounded-lg p-6 hover:shadow-md transition-shadow">
            <div class="flex items-center justify-between mb-4">
                <div class="flex items-center">
                    <span class="text-xl mr-3">â˜ï¸</span>
                    <h3 class="font-semibold text-gray-900">{{ account.cloud_name }}</h3>
                </div>
                <span class="text-xs px-2 py-1 bg-green-100 text-green-700 rounded-full">ì—°ê²°ë¨</span>
            </div>

            <div class="grid grid-cols-2 gap-4 text-sm">
                <div>
                    <p class="text-gray-600">ê³„ì • ID</p>
                    <p class="font-medium">{{ account.account_id }}</p>
                </div>
                <div>
                    <p class="text-gray-600">ë¦¬ì „</p>
                    <p class="font-medium">{{ account.primary_region }}</p>
                </div>
                <div>
                    <p class="text-gray-600">ì—°ê²° ë°©ì‹</p>
                    <p class="font-medium">{{ account.connection_display_name }}</p>
                </div>
                <div>
                    <p class="text-gray-600">ë‹´ë‹¹ì</p>
                    <p class="font-medium">{{ account.contact_email }}</p>
                </div>
            </div>

            <div class="flex gap-2 mt-4">
                <button onclick="window.location.href='{{ url_for('diagnosis.index') }}?account={{ account.account_id }}'" class="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium">ğŸ›¡ï¸ ë³´ì•ˆ ì§„ë‹¨</button>
                <button class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors text-sm font-medium">ğŸ“Š ëª¨ë‹ˆí„°ë§</button>
                <button onclick="deleteAccount('{{ account.account_id }}', '{{ account.cloud_name }}')" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors text-sm font-medium">ğŸ—‘ï¸ ì‚­ì œ</button>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="text-center py-12">
        <div class="text-6xl mb-4">â˜ï¸</div>
        <h3 class="text-lg font-medium text-gray-900 mb-2">ì—°ê²°ëœ AWS ê³„ì •ì´ ì—†ìŠµë‹ˆë‹¤</h3>
        <p class="text-gray-600 mb-6">WALB ë³´ì•ˆ ê´€ë¦¬ë¥¼ ì‹œì‘í•˜ë ¤ë©´ AWS ê³„ì •ì„ ë¨¼ì € ì—°ê²°í•´ì£¼ì„¸ìš”</p>
        <a href="{{ url_for('connection.index') }}" class="inline-block px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium"> â• ì²« ë²ˆì§¸ ê³„ì • ì—°ê²° </a>
    </div>
    {% endif %}
</div>

<!-- Infrastructure Section -->
<div class="bg-white rounded-xl shadow-sm border p-6">
    <div class="flex items-center mb-6">
        <span class="text-2xl mr-3">ğŸ—ï¸</span>
        <h2 class="text-xl font-bold text-gray-900">ì•ˆì „í•œ í´ë¼ìš°ë“œ êµ¬ì¶•</h2>
    </div>

    <p class="text-gray-600 mb-6"><strong>Shift-Left Security ì ìš©</strong> - ì‚¬ì „ ë³´ì•ˆì´ ë‚´ì¥ëœ ìƒˆë¡œìš´ AWS í™˜ê²½ì„ ìë™ êµ¬ì¶•í•©ë‹ˆë‹¤.</p>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
        <div class="flex items-center">
            <span class="text-lg mr-2">ğŸ›¡ï¸</span>
            <span class="text-sm">ì‚¬ì „ ë³´ì•ˆ ë‚´ì¥ ì¸í”„ë¼</span>
        </div>
        <div class="flex items-center">
            <span class="text-lg mr-2">ğŸ“‹</span>
            <span class="text-sm">IaC ê¸°ë°˜ Terraform í…œí”Œë¦¿</span>
        </div>
        <div class="flex items-center">
            <span class="text-lg mr-2">âœ…</span>
            <span class="text-sm">ISMS-P ì»´í”Œë¼ì´ì–¸ìŠ¤ ìë™ ì ìš©</span>
        </div>
    </div>

    <button class="px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors font-medium">ğŸš€ ìƒˆ í™˜ê²½ êµ¬ì¶• ì‹œì‘</button>
</div>
{% endblock %} {% block extra_js %}
<script>
    // ì‹¤ì‹œê°„ ì‹œê°„ ì—…ë°ì´íŠ¸
    function updateTime() {
        const now = new Date();
        const timeString = now.toLocaleString('ko-KR');
        document.getElementById('current-time').textContent = timeString;
    }

    // ì‚¬ì´ë“œë°” í†µê³„ ì—…ë°ì´íŠ¸
    function updateSidebarStats() {
        document.getElementById('total-accounts').textContent = '{{ stats.total_accounts }}';
        document.getElementById('active-accounts').textContent = '{{ stats.active_accounts }}';
    }

    // AWS ê³„ì • ì‚­ì œ í•¨ìˆ˜
    async function deleteAccount(accountId, cloudName) {
        // í™•ì¸ ëª¨ë‹¬
        const confirmed = confirm(`ì •ë§ë¡œ "${cloudName}" (${accountId}) ê³„ì •ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nâš ï¸ ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);
        
        if (!confirmed) {
            return;
        }

        try {
            const response = await fetch('/api/accounts/delete', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    account_id: accountId,
                    cloud_name: cloudName
                })
            });

            const result = await response.json();

            if (result.success) {
                // ì„±ê³µ ë©”ì‹œì§€
                alert(`âœ… "${cloudName}" ê³„ì •ì´ ì„±ê³µì ìœ¼ë¡œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`);
                
                // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
                window.location.reload();
            } else {
                // ì‹¤íŒ¨ ë©”ì‹œì§€
                alert(`âŒ ê³„ì • ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.\nì˜¤ë¥˜: ${result.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}`);
            }
        } catch (error) {
            console.error('Delete account error:', error);
            alert('âŒ ê³„ì • ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\në„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
        }
    }

    // ì´ˆê¸°í™”
    document.addEventListener('DOMContentLoaded', function () {
        updateTime();
        updateSidebarStats();
        setInterval(updateTime, 1000);
    });
</script>
{% endblock %}
