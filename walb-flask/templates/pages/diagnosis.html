{% extends "base.html" %}
{% set page_title = "ë³´ì•ˆ ì§„ë‹¨" %}

{% block title %}{{ page_title }}{% endblock %}

{% block content %}
<div class="diagnosis-container">
    <!-- íˆì–´ë¡œ í—¤ë” -->
    <div class="hero-header">
        <div class="floating-elements">
            <div class="floating-circle circle-1"></div>
            <div class="floating-circle circle-2"></div>
            <div class="floating-circle circle-3"></div>
        </div>
        <div class="hero-content">
            <div class="hero-icon">ğŸ”</div>
            <div class="hero-text">
                <h1 class="hero-title">AWS í´ë¼ìš°ë“œ ë³´ì•ˆ ì§„ë‹¨</h1>
                <p class="hero-subtitle">SK Shieldus 2024 ê°€ì´ë“œë¼ì¸ ê¸°ì¤€ 41ê°œ í•­ëª© ìë™ ì ê²€</p>
            </div>
        </div>
    </div>

    <!-- ê³„ì • ì„ íƒ ì„¹ì…˜ -->
    <div class="account-selection-section">
        <h2 class="section-title">
            <span class="section-icon">â˜ï¸</span>
            ì—°ê²°ëœ AWS ê³„ì •
        </h2>
        
        {% if accounts %}
            <div class="accounts-grid">
                {% for account in accounts %}
                <div class="account-card {% if selected_account and selected_account.account_id == account.account_id %}selected{% endif %}" 
                     data-account-id="{{ account.account_id }}"
                     onclick="selectAccount('{{ account.account_id }}')">
                    <div class="account-header">
                        <h3 class="account-name">{{ account.cloud_name }}</h3>
                        <div class="account-type-badge">
                            {% if account.connection_type == 'role' %}
                                <span class="badge badge-role">Role</span>
                            {% else %}
                                <span class="badge badge-key">Key</span>
                            {% endif %}
                        </div>
                    </div>
                    <div class="account-details">
                        <div class="account-detail">
                            <span class="detail-label">ê³„ì • ID</span>
                            <span class="detail-value">{{ account.account_id }}</span>
                        </div>
                        <div class="account-detail">
                            <span class="detail-label">ë¦¬ì „</span>
                            <span class="detail-value">{{ account.primary_region }}</span>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="empty-state">
                <div class="empty-icon">ğŸ“‹</div>
                <h3>ë“±ë¡ëœ AWS ê³„ì •ì´ ì—†ìŠµë‹ˆë‹¤</h3>
                <p>ë³´ì•ˆ ì§„ë‹¨ì„ ì‹œì‘í•˜ë ¤ë©´ ë¨¼ì € AWS ê³„ì •ì„ ì—°ê²°í•´ì£¼ì„¸ìš”.</p>
                <a href="{{ url_for('connection.index') }}" class="btn btn-primary">
                    <span>ğŸ’«</span> AWS ê³„ì • ì—°ê²°í•˜ê¸°
                </a>
            </div>
        {% endif %}
    </div>

    <!-- ì§„ë‹¨ ì œì–´ íŒ¨ë„ -->
    {% if selected_account %}
    <div class="diagnosis-control-panel" id="controlPanel" style="display: none;">
        <div class="panel-header">
            <h2 class="panel-title">
                <span class="panel-icon">ğŸ”</span>
                ë³´ì•ˆ ì§„ë‹¨ ì œì–´íŒ
            </h2>
            <div class="panel-actions">
                <button class="btn btn-secondary" onclick="testConnection()">
                    <span>ğŸ”—</span> ì—°ê²° í…ŒìŠ¤íŠ¸
                </button>
                <button class="btn btn-primary" onclick="runAllDiagnosis()">
                    <span>ğŸš€</span> ì „ì²´ ì§„ë‹¨ ì‹œì‘
                </button>
            </div>
        </div>
        
        <!-- ì§„ë‹¨ í†µê³„ -->
        <div class="diagnosis-stats">
            <div class="stat-card">
                <div class="stat-icon">ğŸ“Š</div>
                <div class="stat-content">
                    <div class="stat-number">41</div>
                    <div class="stat-label">ì „ì²´ í•­ëª©</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">ğŸ”´</div>
                <div class="stat-content">
                    <div class="stat-number">16</div>
                    <div class="stat-label">ìƒìœ„í—˜</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">ğŸŸ¡</div>
                <div class="stat-content">
                    <div class="stat-number">22</div>
                    <div class="stat-label">ì¤‘ìœ„í—˜</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">ğŸŸ¢</div>
                <div class="stat-content">
                    <div class="stat-number">3</div>
                    <div class="stat-label">ì €ìœ„í—˜</div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- ì§„ë‹¨ í•­ëª© ì„¹ì…˜ -->
    {% if selected_account and sk_items %}
    <div class="diagnosis-items-section" id="diagnosisItems" style="display: none;">
        <h2 class="section-title">
            <span class="section-icon">ğŸ“‹</span>
            ì§„ë‹¨ í•­ëª© ëª©ë¡
        </h2>
        
        {% for category, items in sk_items.items() %}
        <div class="category-section">
            <div class="category-header">
                <h3 class="category-title">{{ category }}</h3>
                <div class="category-meta">
                    <span class="item-count">{{ items|length }}ê°œ í•­ëª©</span>
                    <button class="btn btn-sm btn-outline" onclick="runCategoryDiagnosis('{{ category }}')">
                        <span>ğŸ¯</span> ì¹´í…Œê³ ë¦¬ ì§„ë‹¨
                    </button>
                </div>
            </div>
            
            <div class="items-grid">
                {% for item in items %}
                <div class="diagnosis-item {% if not item.implemented %}item-not-implemented{% endif %}" data-item-code="{{ item.code }}" data-category="{{ category }}">
                    <div class="item-header">
                        <div class="item-code">{{ item.code }}</div>
                        <div class="item-severity severity-{{ item.severity }}">
                            {% if item.severity == 'ìƒ' %}ğŸ”´{% elif item.severity == 'ì¤‘' %}ğŸŸ¡{% else %}ğŸŸ¢{% endif %}
                            {{ item.severity }}
                        </div>
                        {% if not item.implemented %}
                        <div class="item-implementation-status">
                            <span class="badge badge-not-implemented">ë¯¸êµ¬í˜„</span>
                        </div>
                        {% endif %}
                    </div>
                    <div class="item-content">
                        <h4 class="item-name">{{ item.name }}</h4>
                        <p class="item-description">{{ item.description }}</p>
                        {% if not item.implemented %}
                        <p class="item-note">â€» í˜„ì¬ ê°œë°œ ì¤‘ì¸ ê¸°ëŠ¥ì…ë‹ˆë‹¤.</p>
                        {% endif %}
                    </div>
                    <div class="item-actions">
                        {% if item.implemented %}
                        <button class="btn btn-sm btn-primary" onclick="runSingleDiagnosis('{{ item.code }}')">
                            <span>ğŸ”</span> ì§„ë‹¨ ì‹¤í–‰
                        </button>
                        <div class="item-status" id="status-{{ item.code }}">
                            <span class="status-badge status-idle">ëŒ€ê¸°</span>
                        </div>
                        {% else %}
                        <button class="btn btn-sm btn-disabled" disabled>
                            <span>ğŸš§</span> ê°œë°œ ì¤‘
                        </button>
                        <div class="item-status">
                            <span class="status-badge status-not-implemented">ë¯¸êµ¬í˜„</span>
                        </div>
                        {% endif %}
                    </div>
                    
                    <!-- ì§„ë‹¨ ê²°ê³¼ ì˜ì—­ -->
                    {% if item.implemented %}
                    <div class="diagnosis-result" id="result-{{ item.code }}" style="display: none;">
                        <!-- ê²°ê³¼ê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ë¡œë“œë©ë‹ˆë‹¤ -->
                    </div>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- ì§„ë‹¨ ì§„í–‰ ìƒí™© ëª¨ë‹¬ -->
    <div class="diagnosis-progress-modal" id="progressModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ì§„ë‹¨ ì§„í–‰ ìƒí™©</h3>
                <button class="modal-close" onclick="closeProgressModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="progress-stats">
                    <div class="progress-stat">
                        <span class="progress-label">ì§„í–‰ë¥ </span>
                        <span class="progress-value" id="progressPercentage">0%</span>
                    </div>
                    <div class="progress-stat">
                        <span class="progress-label">ì™„ë£Œ</span>
                        <span class="progress-value" id="completedCount">0</span>
                    </div>
                    <div class="progress-stat">
                        <span class="progress-label">ì‹¤íŒ¨</span>
                        <span class="progress-value" id="failedCount">0</span>
                    </div>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="current-item" id="currentItem">ì§„ë‹¨ ì¤€ë¹„ ì¤‘...</div>
            </div>
        </div>
    </div>
</div>

<!-- ë¡œë”© ìŠ¤í”¼ë„ˆ í…œí”Œë¦¿ -->
<div id="loadingTemplate" style="display: none;">
    <div class="diagnosis-loading">
        <div class="loading-spinner"></div>
        <div class="loading-text">ì§„ë‹¨ ì§„í–‰ ì¤‘...</div>
    </div>
</div>

<!-- ê²°ê³¼ í…œí”Œë¦¿ -->
<div id="resultTemplate" style="display: none;">
    <div class="result-header">
        <div class="result-status-badge"></div>
        <div class="result-timestamp"></div>
    </div>
    <div class="result-content">
        <!-- ê²°ê³¼ ë‚´ìš©ì´ ë™ì ìœ¼ë¡œ ì‚½ì…ë©ë‹ˆë‹¤ -->
    </div>
    <div class="result-actions">
        <button class="btn btn-sm btn-secondary" onclick="rediagnose(this)">
            <span>ğŸ”„</span> ì¬ì§„ë‹¨
        </button>
    </div>
</div>

<script>
let selectedAccountId = null;
let diagnosisInProgress = false;

// ê³„ì • ì„ íƒ
function selectAccount(accountId) {
    selectedAccountId = accountId;
    
    // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ìœ¼ë¡œ ì„œë²„ì—ì„œ ë°ì´í„° ë°›ì•„ì˜¤ê¸°
    window.location.href = `/diagnosis?account=${accountId}`;
}

// ì—°ê²° í…ŒìŠ¤íŠ¸
async function testConnection() {
    if (!selectedAccountId) {
        alert('ê³„ì •ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
        return;
    }
    
    try {
        const response = await fetch('/diagnosis/api/test-session', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                account_id: selectedAccountId
            })
        });
        
        const result = await response.json();
        
        if (result.status === 'success') {
            alert(`âœ… ì—°ê²° í…ŒìŠ¤íŠ¸ ì„±ê³µ!\nê³„ì • ID: ${result.account_id}\nì ‘ê·¼ ê°€ëŠ¥ ë¦¬ì „: ${result.regions}ê°œ`);
        } else {
            alert(`âŒ ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨\n${result.error_message}`);
        }
    } catch (error) {
        alert(`ì—°ê²° í…ŒìŠ¤íŠ¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`);
    }
}

// ê°œë³„ ì§„ë‹¨ ì‹¤í–‰
async function runSingleDiagnosis(itemCode) {
    if (!selectedAccountId) {
        alert('ê³„ì •ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
        return;
    }
    
    const statusElement = document.getElementById(`status-${itemCode}`);
    const resultElement = document.getElementById(`result-${itemCode}`);
    
    // ì§„í–‰ ìƒíƒœë¡œ ë³€ê²½
    statusElement.innerHTML = '<span class="status-badge status-running">ì§„í–‰ì¤‘</span>';
    resultElement.style.display = 'none';
    
    try {
        const response = await fetch('/diagnosis/api/run', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                account_id: selectedAccountId,
                item_code: itemCode
            })
        });
        
        const result = await response.json();
        
        if (result.status === 'success') {
            statusElement.innerHTML = '<span class="status-badge status-completed">ì™„ë£Œ</span>';
            displayDiagnosisResult(itemCode, result);
        } else {
            statusElement.innerHTML = '<span class="status-badge status-failed">ì‹¤íŒ¨</span>';
            resultElement.innerHTML = `<div class="error-message">âŒ ${result.message}</div>`;
            resultElement.style.display = 'block';
        }
    } catch (error) {
        statusElement.innerHTML = '<span class="status-badge status-failed">ì‹¤íŒ¨</span>';
        resultElement.innerHTML = `<div class="error-message">âŒ ì§„ë‹¨ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}</div>`;
        resultElement.style.display = 'block';
    }
}

// ì „ì²´ ì§„ë‹¨ ì‹¤í–‰
async function runAllDiagnosis() {
    if (!selectedAccountId) {
        alert('ê³„ì •ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
        return;
    }
    
    if (diagnosisInProgress) {
        alert('ì´ë¯¸ ì§„ë‹¨ì´ ì§„í–‰ ì¤‘ì…ë‹ˆë‹¤.');
        return;
    }
    
    diagnosisInProgress = true;
    showProgressModal();
    
    try {
        const response = await fetch('/diagnosis/api/run-all', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                account_id: selectedAccountId
            })
        });
        
        const result = await response.json();
        
        if (result.status === 'success') {
            updateProgressModal(100, result.success_count, result.failed_count);
            setTimeout(() => {
                closeProgressModal();
                alert(`âœ… ì „ì²´ ì§„ë‹¨ ì™„ë£Œ!\nì„±ê³µ: ${result.success_count}ê°œ\nì‹¤íŒ¨: ${result.failed_count}ê°œ`);
            }, 1000);
        } else {
            alert(`âŒ ì „ì²´ ì§„ë‹¨ ì‹¤íŒ¨\n${result.message}`);
        }
    } catch (error) {
        alert(`ì „ì²´ ì§„ë‹¨ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`);
    } finally {
        diagnosisInProgress = false;
        closeProgressModal();
    }
}

// ì§„ë‹¨ ê²°ê³¼ í‘œì‹œ
function displayDiagnosisResult(itemCode, result) {
    const resultElement = document.getElementById(`result-${itemCode}`);
    const diagnosisResult = result.result;
    
    let resultHTML = '<div class="result-summary">';
    
    if (diagnosisResult.status === 'success') {
        resultHTML += `<div class="result-item">
            <strong>ìœ„í—˜ë„:</strong> <span class="risk-level risk-${diagnosisResult.risk_level}">${diagnosisResult.risk_level}</span>
        </div>`;
        
        if (diagnosisResult.has_issues) {
            resultHTML += '<div class="result-item"><strong>âš ï¸ ë³´ì•ˆ ì´ìŠˆê°€ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤</strong></div>';
        } else {
            resultHTML += '<div class="result-item"><strong>âœ… ë³´ì•ˆ ì´ìŠˆê°€ ë°œê²¬ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤</strong></div>';
        }
        
        // ìš”ì•½ ì •ë³´ í‘œì‹œ
        if (diagnosisResult.summary) {
            resultHTML += `<div class="result-item"><strong>summary:</strong> ${diagnosisResult.summary}</div>`;
        }
        
        // ìƒì„¸ ì •ë³´ê°€ ìˆìœ¼ë©´ êµ¬ì¡°í™”ëœ í˜•íƒœë¡œ í‘œì‹œ
        if (diagnosisResult.details && typeof diagnosisResult.details === 'object') {
            resultHTML += '<div class="result-details">';
            Object.entries(diagnosisResult.details).forEach(([key, value]) => {
                if (typeof value === 'object' && value !== null) {
                    resultHTML += `<div class="detail-section"><strong>${key}:</strong>`;
                    if (value.count !== undefined) {
                        resultHTML += ` ${value.count}ê°œ`;
                    }
                    if (value.users && Array.isArray(value.users)) {
                        resultHTML += ` (${value.users.join(', ')})`;
                    }
                    if (value.description) {
                        resultHTML += ` - ${value.description}`;
                    }
                    resultHTML += '</div>';
                } else {
                    resultHTML += `<div class="result-item"><strong>${key}:</strong> ${value}</div>`;
                }
            });
            resultHTML += '</div>';
        }
        
        // ìë™ ì¡°ì¹˜ ì˜µì…˜ í‘œì‹œ
        if (diagnosisResult.fix_options && Array.isArray(diagnosisResult.fix_options)) {
            resultHTML += '<div class="fix-options">';
            resultHTML += '<strong>ìë™ ì¡°ì¹˜ ì˜µì…˜:</strong>';
            diagnosisResult.fix_options.forEach((option, index) => {
                resultHTML += `
                    <div class="fix-option">
                        <div class="fix-option-header">
                            <h4>${option.title}</h4>
                            <p>${option.description}</p>
                        </div>
                        <div class="fix-option-items">
                            ${option.items.map(item => `
                                <label class="fix-item">
                                    <input type="checkbox" value="${item.id}" data-option-id="${option.id}" checked>
                                    <span>${item.name} - ${item.description}</span>
                                </label>
                            `).join('')}
                        </div>
                        <button class="btn btn-warning btn-fix" onclick="executeFix('${itemCode}', '${option.id}')">
                            <span>âš¡</span> ${option.title} ì‹¤í–‰
                        </button>
                    </div>
                `;
            });
            resultHTML += '</div>';
        }
    } else {
        resultHTML += `<div class="error-message">âŒ ${diagnosisResult.error_message}</div>`;
    }
    
    resultHTML += '</div>';
    
    resultElement.innerHTML = resultHTML;
    resultElement.style.display = 'block';
}

// ì§„í–‰ ìƒí™© ëª¨ë‹¬ ê´€ë ¨ í•¨ìˆ˜ë“¤
function showProgressModal() {
    document.getElementById('progressModal').style.display = 'flex';
    updateProgressModal(0, 0, 0);
}

function closeProgressModal() {
    document.getElementById('progressModal').style.display = 'none';
}

function updateProgressModal(percentage, completed, failed) {
    document.getElementById('progressPercentage').textContent = `${percentage}%`;
    document.getElementById('completedCount').textContent = completed;
    document.getElementById('failedCount').textContent = failed;
    document.getElementById('progressFill').style.width = `${percentage}%`;
}

// ìë™ ì¡°ì¹˜ ì‹¤í–‰
async function executeFix(itemCode, optionId) {
    if (!selectedAccountId) {
        alert('ê³„ì •ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
        return;
    }
    
    // ì„ íƒëœ í•­ëª©ë“¤ ìˆ˜ì§‘
    const checkboxes = document.querySelectorAll(`input[data-option-id="${optionId}"]:checked`);
    if (checkboxes.length === 0) {
        alert('ì¡°ì¹˜í•  í•­ëª©ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
        return;
    }
    
    const selectedItems = {};
    selectedItems[optionId] = Array.from(checkboxes).map(cb => ({
        id: cb.value,
        name: cb.value,
        description: cb.parentElement.textContent.trim()
    }));
    
    // í™•ì¸ ë©”ì‹œì§€
    const itemCount = checkboxes.length;
    const confirmMessage = `ì •ë§ë¡œ ${itemCount}ê°œ í•­ëª©ì— ëŒ€í•´ ìë™ ì¡°ì¹˜ë¥¼ ì‹¤í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nâš ï¸ ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`;
    
    if (!confirm(confirmMessage)) {
        return;
    }
    
    try {
        // ì‹¤í–‰ ë²„íŠ¼ ë¹„í™œì„±í™”
        const executeButton = event.target;
        const originalText = executeButton.innerHTML;
        executeButton.disabled = true;
        executeButton.innerHTML = '<span>â³</span> ì‹¤í–‰ ì¤‘...';
        
        const response = await fetch('/diagnosis/api/fix', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                account_id: selectedAccountId,
                item_code: itemCode,
                selected_items: selectedItems
            })
        });
        
        const result = await response.json();
        
        if (result.status === 'success') {
            let successCount = 0;
            let failCount = 0;
            let message = 'ìë™ ì¡°ì¹˜ ì‹¤í–‰ ê²°ê³¼:\n\n';
            
            result.results.forEach(res => {
                if (res.status === 'success') {
                    successCount++;
                    message += `âœ… ${res.message}\n`;
                } else {
                    failCount++;
                    message += `âŒ ${res.message}\n`;
                }
            });
            
            message += `\nì„±ê³µ: ${successCount}ê°œ, ì‹¤íŒ¨: ${failCount}ê°œ`;
            alert(message);
            
            // ì„±ê³µí–ˆìœ¼ë©´ í•´ë‹¹ í•­ëª© ì¬ì§„ë‹¨
            if (successCount > 0) {
                setTimeout(() => {
                    runSingleDiagnosis(itemCode);
                }, 1000);
            }
        } else {
            alert(`âŒ ìë™ ì¡°ì¹˜ ì‹¤íŒ¨\n${result.message}`);
        }
        
        // ë²„íŠ¼ ë³µêµ¬
        executeButton.disabled = false;
        executeButton.innerHTML = originalText;
        
    } catch (error) {
        alert(`ìë™ ì¡°ì¹˜ ì‹¤í–‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`);
        
        // ë²„íŠ¼ ë³µêµ¬
        const executeButton = event.target;
        executeButton.disabled = false;
        executeButton.innerHTML = originalText;
    }
}

// ì¬ì§„ë‹¨
function rediagnose(button) {
    const itemElement = button.closest('.diagnosis-item');
    const itemCode = itemElement.dataset.itemCode;
    runSingleDiagnosis(itemCode);
}

// í˜ì´ì§€ ë¡œë“œ ì‹œ ì„ íƒëœ ê³„ì •ì´ ìˆìœ¼ë©´ ìë™ ì„ íƒ
document.addEventListener('DOMContentLoaded', function() {
    {% if selected_account %}
    selectedAccountId = '{{ selected_account.account_id }}';
    
    // ì œì–´íŒê³¼ ì§„ë‹¨ í•­ëª©ì´ ì¡´ì¬í•˜ë©´ í‘œì‹œ
    const controlPanel = document.getElementById('controlPanel');
    const diagnosisItems = document.getElementById('diagnosisItems');
    
    if (controlPanel) {
        controlPanel.style.display = 'block';
    }
    if (diagnosisItems) {
        diagnosisItems.style.display = 'block';
    }
    {% endif %}
});
</script>
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/pages/diagnosis.css') }}">
{% endblock %}